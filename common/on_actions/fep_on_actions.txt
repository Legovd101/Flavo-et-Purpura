on_startup = {
	events = {
		flavor_ven.0
	}
	set_variable = {
		which = latin_unity
		value = 0
	}
}
on_monarch_death = {
	events = {
		flavor_blu.1			#Death of Kaidu Khan
	}
}
on_new_monarch = {
	events = {
		flavor_bry.1			#Brythonian Succession
	}
}

# on_monarch_death = {
# 	events = {
# 	}
# }

# root = loser country, from = winner country
on_war_lost = {
	if = {
		limit = {
			FROM = { has_country_flag = shaking_off_yoke }
		}
		FROM = { clr_country_flag = shaking_off_yoke }
		BLU = {
			add_government_power = { # sets the power to the specified amount
				mechanic_type = mongol_yoke
				power_type = stranglehold
				value = -15
			}
		}
	}
}

# root = winning country, from = loser country
on_war_won = {
	if = {
		limit = {
			FROM = { has_country_flag = shaking_off_yoke }
		}
		FROM = { clr_country_flag = shaking_off_yoke }
		BLU = {
			add_government_power = { # sets the power to the specified amount
				mechanic_type = mongol_yoke
				power_type = stranglehold
				value = 10
			}
		}
	}
}

on_mercenary_recruited = {
	if = {
		limit = {
			FROM = {
				currently_employing_varangians_trigger = yes
			}
		}
		add_estate_loyalty = {
			estate = estate_varangians
			loyalty = 5
		}
	}
}

on_province_owner_change = {
	# European Colonies (Benin)
	if = {
		limit = {
			ROOT = {
				owner = {
					any_subject_country = {
						is_subject_of_type = european_colony
						capital_scope = { region = ROOT }
					}
				}
			}
		}
		random_subject_country = {
			limit = {
				is_subject_of_type = european_colony
				capital_scope = {
					region = ROOT
				}
			}
			ROOT = { cede_province = PREV }
		}
	}
	# Extension of Vineyard System/Establishment of Wineries (Ga√≠liza)
	if = {
		limit = {
			owner = {
				has_country_flag = wine_wank
			}
			trade_goods = wine
		}
		add_permanent_province_modifier = {
			name = locally_owned_vineyards
			duration = -1
		}
	}
	if = {
		limit = {
			owner = {
				has_country_flag = wine_wank
			}
		}
		owner = {
			every_owned_province = {
				limit = {
					NOT = {
						OR = {
							region = iberia_region
							area = corsica_area
							area = corsica_sardinia_area
							area = cyprus_area
							area = crete_area
							province_id = 118
							province_id = 151
							province_id = 316
							province_id = 341
							province_id = 358
						}
					}
				}
				province_event = {
					id = fep_iberian_flavor.11
				}
			}
		}
	}
}

on_province_religion_converted = {
}
on_province_religion_changed = {
	if = {
		limit = {
			has_province_modifier = local_jewish_community
		}
		remove_province_modifier = local_jewish_community
	}
}

on_monthly_pulse = {
	if = {
		limit = { has_country_flag = wine_wank }
		set_variable = {
			which = wine_provinces
			value = 0
		}
		set_variable = {
			which = wine_percentage_check
			value = 0
		}
		every_province = {
			limit = {
				trade_goods = wine
				OR = {
					has_province_modifier = state_owned_vineyards
					has_province_modifier = locally_owned_vineyards
				}
			}
			ROOT = {
				change_variable = {
					which = wine_provinces
					value = 1
				}
			}
		}
		every_province = {
			limit = {
				trade_goods = wine
				OR = {
					has_province_modifier = state_owned_vineyards
				}
			}
			ROOT = {
				change_variable = {
					which = wine_percentage_check
					value = 1
				}
			}
		}
		divide_variable = {
			which = wine_percentage_check
			which = wine_provinces
		}
		multiply_variable = {
			which = wine_percentage_check
			value = 100
		}
	}

	# Latin Unity Calculation
	if = {
		limit = {
			has_subject_of_type = league_member
		}
		set_variable = {
			which = latin_unity_gain
			value = 0
		}
		set_variable = {
			which = latin_provinces_count
			value = 0
		}
		set_variable = {
			which = latin_heretic_provinces
			value = 0
		}
		set_variable = {
			which = latin_league_members
			value = 0
		}
		set_variable = {
			which = latin_member_gain
			value = 0
		}
		set_variable = {
			which = latin_internal_war_members
			value = 0
		}
		set_variable = {
			which = latin_defending_members
			value = 0
		}
		set_variable = {
			which = latin_attacking_members
			value = 0
		}
		set_variable = {
			which = latin_internal_war_gain
			value = 0
		}
		set_variable = {
			which = latin_defending_gain
			value = 0
		}
		set_variable = {
			which = latin_attacking_gain
			value = 0
		}
		set_variable = {
			which = latin_peacetime_gain
			value = 0
		}

		## League Religious Unity Calculation
		every_province = {
			limit = { owner = { is_in_latin_league = yes } }
			change_variable = {
				which = latin_provinces_count
				value = 1
			}
			if = {
				limit = { NOT = { religion = ROOT } }
				change_variable = {
					which = latin_heretic_provinces
					value = 1
				}
			}
		}
		set_variable = {
			which = latin_religious_unity
			which = latin_heretic_provinces
		}
		divide_variable = {
			which = latin_religious_unity
			which = latin_provinces_count
		}
		set_variable = {
			which = latin_religious_unity_gain
			which = latin_religious_unity
		}
		subtract_variable = {
			which = latin_religious_unity_gain
			value = 0.5
		}
		multiply_variable = {
			which = latin_religious_unity
			value = -100
		}
		change_variable = {
			which = latin_religious_unity
			value = 100
		}

		## League Member Calculations
		every_country = {
			limit = { is_in_latin_league = yes }
			change_variable = {
				which = latin_league_members
				value = 1
			}	
			change_variable = {
				which = latin_member_gain
				value = 0.15
			}
			### War Calculations
			#### Internal War Debuff
			if = {
				limit = {
					any_country = {
						is_in_latin_league = yes
						OR = {
							is_in_war = {
								attacker_leader = PREV
								defender_leader = THIS
							}
							is_in_war = {
								attacker_leader = THIS
								defender_leader = PREV
							}
						}
					}
				}
				change_variable = {
					which = latin_internal_war_gain
					value = 0.5
				}
				change_variable = {
					which = latin_internal_war_members
					value = 1
				}
			}
			#### Offensive War Buff
			if = {
				limit = {
					OR = {
						any_country = {
							is_in_latin_league = no
							is_in_war = {
								attacker_leader = PREV
								defender_leader = THIS
							}
						}
						any_country = {
							is_in_latin_league = yes
							any_country = {
								is_in_latin_league = no
								is_in_war = {
									attacker_leader = PREV
									defender_leader = THIS
								}
							}
							PREV = {
								offensive_war_with = PREV
							}
						}
					}
				}
				change_variable = {
					which = latin_attacking_gain
					value = 0.2
				}
				change_variable = {
					which = latin_attacking_members
					value = 1
				}
			}
			#### Defensive War Buff
			if = {
				limit = {
					OR = {
						any_country = {
							is_in_latin_league = no
							is_in_war = {
								attacker_leader = THIS
								defender_leader = PREV
							}
						}
						any_country = {
							is_in_latin_league = yes
							any_country = {
								is_in_latin_league = no
								is_in_war = {
									attacker_leader = THIS
									defender_leader = PREV
								}
							}
							PREV = {
								defensive_war_with = PREV
							}
						}
					}
				}
				change_variable = {
					which = latin_defending_gain
					value = 0.25
				}
				change_variable = {
					which = latin_defending_members
					value = 1
				}
			}
		}
		if = {
			limit = {
				all_country = {
					OR = {
						is_in_latin_league = no
						is_at_war = no
					}
				}
			}
			change_variable = {
				which = latin_peacetime_gain
				value = 1.0
			}						
		}
		## Final Unity Calculation
		subtract_variable = {
			which = latin_unity_gain
			which = latin_religious_unity_gain
		}

		subtract_variable = {
			which = latin_unity_gain
			which = latin_internal_war_gain
		}

		change_variable = {
			which = latin_unity_gain
			which = latin_member_gain
		}

		change_variable = {
			which = latin_unity_gain
			which = latin_defending_gain
		}

		change_variable = {
			which = latin_unity_gain
			which = latin_attacking_gain
		}

		change_variable = {
			which = latin_unity_gain
			which = latin_peacetime_gain
		}

	}
}